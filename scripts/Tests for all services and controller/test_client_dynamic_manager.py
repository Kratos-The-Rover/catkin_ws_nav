#!/usr/bin/env python

import sys
import rospy
from navigation.srv import *
from navigation.msg import *
import numpy as np
import os
from std_msgs.msg import String
from sensor_msgs.msg import LaserScan

# from context import RRT, utils
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '../rrt_for_scan')))
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '../rrt_star')))
from utils_scan import scan_obstacle_checker, make_obstacles_scan, check_intersection_scan
from utils_scan import adjustable_random_sampler as sampler
from descartes import PolygonPatch
from shapely.geometry import Polygon, Point, LineString
import random
import math, time
import matplotlib.pyplot as plt


sys.path.append(os.path.dirname(os.path.abspath(__file__)) +
                "/../rrt_for_scan/")
sys.path.append(os.path.dirname(os.path.abspath(__file__)) +
                "/../rrt_star/")



try:
    from rrt import RRT
    #from rrt_star_scan1 import RRTSTar
except ImportError:
    raise

show_animation = True

start_time = 0
show_animation=True
def dynamic_client(x, y,z):
    print("Starting dynamic_client")
    rospy.wait_for_service('dynamic_planner_service')
    try:
        check_intersect = rospy.ServiceProxy('dynamic_planner_service', Dynamic)
        print("Proxy created")
        resp1 = check_intersect(x, y, z)
        # print(resp1)
        return resp1.ack
    except rospy.ServiceException, e:
        print "Service call failed: %s"%e


if __name__ == "__main__":
    inf=100
    nan=1000
    scan_list = [3.7304484844207764, 3.727701187133789, 3.7249608039855957, 3.722227096557617, 3.7167792320251465, 3.7140655517578125, 3.7113587856292725, 3.7086586952209473, 3.705965518951416, 3.7032790184020996, 3.6979262828826904, 3.695260524749756, 3.692601442337036, 3.6899490356445312, 3.6873040199279785, 3.6820342540740967, 3.6794097423553467, 3.6767923831939697, 3.6741819381713867, 3.6715784072875977, 3.6689820289611816, 3.6638104915618896, 3.6612353324890137, 3.6586673259735107, 3.6561062335968018, 3.653552532196045, 3.651005744934082, 3.6484663486480713, 3.64340877532959, 3.6408908367156982, 3.638380289077759, 3.6358768939971924, 3.633380889892578, 3.630892038345337, 3.6284103393554688, 3.623469591140747, 3.6210098266601562, 3.618557929992676, 3.6161131858825684, 3.613675832748413, 3.611246109008789, 3.608823537826538, 3.6064085960388184, 3.6016011238098145, 3.5992088317871094, 3.5968239307403564, 3.5944464206695557, 3.592076539993286, 3.589714288711548, 3.58735990524292, 3.585012912750244, 3.5826733112335205, 3.5780177116394043, 3.5757014751434326, 3.573392629623413, 3.571091890335083, 3.568798542022705, 3.5665132999420166, 3.5642356872558594, 3.5619659423828125, 3.5597035884857178, 3.5574493408203125, 3.552964687347412, 3.550734043121338, 3.548511266708374, 3.5462963581085205, 3.5440895557403564, 3.541890859603882, 3.5396997928619385, 3.5375165939331055, 3.535341501235962, 3.533174753189087, 3.531015634536743, 3.528864860534668, 3.526721954345703, 3.522460460662842, 3.5203421115875244, 3.5182318687438965, 3.5161292552948, 3.514035224914551, 3.5119495391845703, 3.5098717212677, 3.5078024864196777, 3.5057411193847656, 3.503688097000122, 3.501643419265747, 3.4996070861816406, 3.4975788593292236, 3.495558977127075, 3.4935474395751953, 3.491544485092163, 3.4895496368408203, 3.487563371658325, 3.4855854511260986, 3.4816548824310303, 3.4797019958496094, 3.4777579307556152, 3.4758222103118896, 3.4738950729370117, 3.4719765186309814, 3.470066547393799, 3.4681649208068848, 3.4662716388702393, 3.4643874168395996, 3.4625115394592285, 3.460644245147705, 3.4587857723236084, 3.4569358825683594, 3.455094814300537, 3.4532623291015625, 3.4514384269714355, 3.4496231079101562, 3.447816848754883, 3.446019172668457, 3.444230318069458, 3.4424502849578857, 3.440678834915161, 3.4389164447784424, 3.4371628761291504, 3.435417890548706, 3.4336819648742676, 3.431954860687256, 3.43023681640625, 3.428527355194092, 3.4268269538879395, 3.425135612487793, 3.4234533309936523, 3.4217796325683594, 3.4201152324676514, 3.41845965385437, 3.416813373565674, 3.4151759147644043, 3.4135475158691406, 3.411928176879883, 3.41031813621521, 3.4087166786193848, 3.4071245193481445, 3.4055418968200684, 3.403968095779419, 3.4024033546447754, 3.400848150253296, 3.399301767349243, 3.3977646827697754, 3.3962368965148926, 3.3947181701660156, 3.3932089805603027, 3.3917086124420166, 3.3902177810668945, 3.3887362480163574, 3.3872640132904053, 3.385801315307617, 3.384347677230835, 3.382903575897217, 3.3814685344696045, 3.3800430297851562, 3.378627061843872, 3.377220392227173, 3.3758227825164795, 3.3744351863861084, 3.373056650161743, 3.371687889099121, 3.370328426361084, 3.368978500366211, 3.367638111114502, 3.366307258605957, 3.364985466003418, 3.363673686981201, nan, 3.3623714447021484, 3.3610787391662598, 3.359795570373535, 3.3585221767425537, 3.3572580814361572, 3.356003761291504, 3.3547592163085938, 3.3535239696502686, 3.3522989749908447, 3.351083278656006, 3.349877119064331, 3.3486809730529785, 3.34749436378479, 3.346317768096924, 3.3451504707336426, 3.3439934253692627, 3.3428456783294678, 3.341707944869995, 3.3405799865722656, 3.3394618034362793, 3.338353395462036, 3.3372550010681152, nan, 3.3361663818359375, 3.335087537765503, 3.3340187072753906, 3.3329596519470215, 3.3319103717803955, 3.330871105194092, 3.3298418521881104, 3.328822612762451, 3.327812910079956, 3.3268134593963623, 3.325824022293091, 3.3248443603515625, 3.3238747119903564, 3.3229150772094727, 3.321965456008911, 3.321026086807251, nan, 3.320096492767334, 3.3191769123077393, 3.318267583847046, 3.317368268966675, 3.316478967666626, 3.3155996799468994, 3.314730405807495, 3.313871383666992, 3.3130223751068115, 3.3121836185455322, 3.3113551139831543, 3.3105366230010986, 3.3097283840179443, 3.3089301586151123, nan, 3.3081419467926025, 3.3073644638061523, 3.3065967559814453, 3.3058393001556396, 3.3050920963287354, 3.3043551445007324, 3.303628444671631, 3.3029119968414307, 3.3022055625915527, 3.3015096187591553, 3.300823926925659, 3.3001487255096436, 3.29948353767395, nan, 3.2988288402557373, 3.2981839179992676, 3.2975497245788574, 3.2969260215759277, 3.2963125705718994, 3.2957093715667725, 3.295116424560547, 3.2945339679718018, 3.293961763381958, 3.2934000492095947, 3.292848587036133, 3.2923076152801514, nan, 3.2917771339416504, 3.291256904602051, 3.2907471656799316, 3.290247917175293, 3.2897586822509766, 3.289280414581299, 3.2888123989105225, 3.2883546352386475, 3.287907361984253, 3.287470817565918, 3.2870445251464844, nan, 3.2866289615631104, 3.2862236499786377, 3.2858288288116455, 3.285444498062134, 3.2850706577301025, 3.284707546234131, 3.2843546867370605, 3.28401255607605, 3.2836809158325195, 3.2833597660064697, nan, 3.2830491065979004, 3.2827489376068115, 3.2824594974517822, 3.2821803092956543, 3.281912088394165, 3.2816543579101562, 3.281407117843628, 3.281170129776001, 3.2809441089630127, 3.280728578567505, 3.2805235385894775, nan, 3.2803292274475098, 3.2801454067230225, 3.2799720764160156, 3.2798097133636475, 3.2796578407287598, 3.2795164585113525, 3.279385566711426, 3.2792656421661377, 3.27915620803833, 3.279057502746582, nan, 3.2789690494537354, 3.2788918018341064, 3.2788245677948, 3.278768539428711, 3.2787230014801025, 3.2786877155303955, 3.2786636352539062, 3.2786498069763184, 3.278646945953369, 3.2786545753479004, nan, 3.278672933578491, 3.2787020206451416, 3.2787415981292725, 3.278791904449463, 3.278852939605713, 3.2789244651794434, 3.2790069580078125, 3.279099941253662, 3.2792038917541504, nan, 3.27931809425354, 3.2794435024261475, 3.2795794010162354, 3.2797255516052246, 3.2798829078674316, 3.280050754547119, 3.280229330062866, 3.280418634414673, 3.280618667602539, 3.280829429626465, nan, 3.281050682067871, 3.281282663345337, 3.2815253734588623, 3.2817788124084473, 3.282042980194092, 3.282317876815796, 3.2826032638549805, 3.2828993797302246, 3.2832064628601074, 3.2835240364074707, nan, 3.2838523387908936, 3.284191131591797, 3.284540891647339, 3.2849013805389404, 3.2852723598480225, 3.285654067993164, 3.2860467433929443, 3.286449909210205, 3.2868635654449463, 3.287288188934326, nan, 3.2877233028411865, 3.2881691455841064, 3.288625717163086, 3.289093017578125, 3.2895708084106445, 3.2900593280792236, 3.2905585765838623, 3.2910683155059814, 3.2915890216827393, 3.2921202182769775, nan, 3.2926621437072754, 3.2932145595550537, 3.2937779426574707, 3.294351816177368, 3.294936418533325, 3.2955312728881836, 3.2961373329162598, 3.2967536449432373, 3.2973806858062744, 3.298018455505371, nan, 3.2986669540405273, 3.299325704574585, 3.2999954223632812, 3.300675630569458, 3.3013665676116943, 3.302067995071411, 3.3027801513671875, 3.3035027980804443, 3.3042359352111816, 3.3049800395965576, 3.305734634399414, nan, 3.306499481201172, 3.3072750568389893, 3.308061361312866, 3.3088581562042236, 3.3096656799316406, 3.310483455657959, 3.311311960220337, 3.3121511936187744, 3.3130006790161133, 3.3138608932495117, 3.3147315979003906, 3.315612554550171, nan, 3.31650447845459, 3.31740665435791, 3.318319320678711, 3.3192427158355713, 3.320176362991333, 3.3211207389831543, 3.322075605392456, 3.3230409622192383, 3.324016571044922, 3.325002670288086, 3.3259994983673096, 3.3270065784454346, nan, 3.328023910522461, 3.329051971435547, 3.3300905227661133, 3.331139326095581, 3.3321988582611084, 3.333268404006958, 3.334348440170288, 3.3354389667510986, 3.3365399837493896, 3.337651014328003, 3.338772773742676, 3.33990478515625, 3.3410472869873047, 3.3422000408172607, nan, 3.343363046646118, 3.344536542892456, 3.3457202911376953, 3.346914291381836, 3.348118782043457, 3.3493335247039795, 3.3505585193634033, 3.3517935276031494, 3.353039264678955, 3.354295015335083, 3.3555612564086914, 3.356837749481201, 3.358124017715454, 3.3594210147857666, 3.3607280254364014, nan, 3.3620452880859375, 3.363372802734375, 3.3647103309631348, 3.366058111190796, 3.3674161434173584, 3.368784189224243, 3.3701627254486084, 3.371551275253296, 3.3729498386383057, 3.374358654022217, 3.375777244567871, 3.377206563949585, 3.378645420074463, 3.3800947666168213, 3.381553888320923, 3.383023262023926, 3.384502410888672, 3.3859920501708984, 3.387491464614868, nan, 3.38900089263916, 3.3905203342437744, 3.392049789428711, 3.3935892581939697, 3.395138740539551, 3.396698236465454, 3.3982677459716797, 3.3998470306396484, 3.4014363288879395, 3.4030354022979736, 3.40464448928833, 3.4062633514404297, 3.4078924655914307, 3.4095311164855957, 3.411179780960083, 3.4128384590148926, 3.414506673812866, 3.416184902191162, 3.417872905731201, 3.4195706844329834, 3.421278238296509, 3.4229958057403564, 3.424722671508789, 3.426459789276123, 3.428206443786621, 3.4299628734588623, 3.4317290782928467, 3.433504819869995, 3.4352903366088867, 3.4370856285095215, 3.4388904571533203, 3.4407052993774414, 3.4425294399261475, 3.4443631172180176, 3.44620680809021, 3.4480597972869873, 3.4499223232269287, 3.4517948627471924, nan, 3.453676462173462, 3.4555680751800537, 3.4574689865112305, 3.4593794345855713, 3.461299419403076, 3.463228940963745, 3.465167999267578, 3.467116594314575, 3.4690744876861572, 3.4710419178009033, 3.4730186462402344, 3.4750049114227295, 3.4770004749298096, 3.4790055751800537, 3.481019973754883, 3.483044147491455, 3.485077142715454, 3.4891717433929443, 3.4912326335906982, 3.4933032989501953, 3.4953830242156982, 3.497472047805786, 3.499570369720459, 3.501677989959717, 3.5037946701049805, 3.505920886993408, 3.508056163787842, 3.510200262069702, 3.5123538970947266, 3.514516592025757, 3.516688346862793, 3.518869638442993, 3.52105975151062, 3.523259162902832, 3.5254673957824707, 3.5276846885681152, 3.5299112796783447, 3.532146692276001, 3.534391403198242, 3.53664493560791, 3.538907527923584, 3.5411789417266846, 3.54345965385437, 3.5457489490509033, 3.5480475425720215, 3.5503549575805664, 3.552671194076538, 3.5549964904785156, 3.55733060836792, 3.559673547744751, 3.562025308609009, 3.5667552947998047, 3.5691335201263428, 3.5715205669403076, 3.57391619682312, 3.5763211250305176, 3.5787343978881836, 3.5811562538146973, 3.583587408065796, 3.586026668548584, 3.588474988937378, 3.5909318923950195, 3.593397378921509, 3.595871686935425, 3.5983543395996094, 3.6008458137512207, 3.6033458709716797, 3.6083714962005615, 3.6108973026275635, 3.613431453704834, 3.615974187850952, 3.618525505065918, 3.6210854053497314, 3.6236536502838135, 3.626230239868164, 3.6288154125213623, 3.631409168243408, 3.6340110301971436, 3.6366214752197266, 3.6418673992156982, 3.644502639770508, 3.647146463394165, 3.64979887008667, 3.652458906173706, 3.655127763748169, 3.6578047275543213, 3.660490036010742, 3.6631836891174316, 3.6658854484558105, 3.6713132858276367, 3.674039602279663, 3.676774263381958, 3.6795167922973633, 3.682267427444458, 3.685026168823242, 3.687793493270874, 3.690568208694458, 3.6961426734924316, 3.698941946029663, 3.701749324798584, 3.704564332962036, 3.707387685775757, 3.710218906402588, 3.7130579948425293, 3.71590518951416, 3.721622943878174, 3.7244937419891357, 3.727372646331787, 3.7302591800689697, 3.7331535816192627, 3.736055850982666, 3.7389657497406006, 3.74480938911438, 3.7477431297302246, 3.7506840229034424, 3.7536332607269287, 3.756589651107788, 3.759554147720337, 3.765505790710449, 3.768493175506592, 3.7714884281158447, 3.77449107170105, 3.777501106262207, 3.7805190086364746, 3.7865774631500244, 3.7896182537078857, 3.79266619682312, 3.7957217693328857, 3.7987849712371826, 3.804933547973633, 3.8080191612243652, 3.81111216545105, 3.8142125606536865, 3.8173203468322754, 3.8204355239868164, 3.826688051223755, 3.8298254013061523, 3.832969903945923, 3.8361217975616455, 3.8392810821533203]
    start_pose = Point_xy([0,0])
    goal_pose = Point_xy([6.403,0])
   
    #print "Requesting %s+%s"%(x, y)
    intersection = dynamic_client(start_pose,goal_pose,scan_list)
    
    if intersection:
        print("There is no intersection.")
    else:
        print("There is an intersection.")
       # final_path = path

        